NAME = fractol
CC = cc
CFLAGS = -Wall -Wextra -Werror -Imlx

MLX_DIR = mlx
MLX_FLAGS = -L$(MLX_DIR) -lmlx -lXext -lX11 -lm

SRC_DIR = src
SRCS = $(SRC_DIR)/main.c \
       $(SRC_DIR)/init.c \
       $(SRC_DIR)/events.c \
       $(SRC_DIR)/render.c \
       $(SRC_DIR)/mandelbrot.c \
       $(SRC_DIR)/julia.c \
       $(SRC_DIR)/utils.c \
       $(SRC_DIR)/colors.c

OBJS = $(SRCS:.c=.o)

all: $(NAME)

$(NAME): $(OBJS)
	$(CC) $(CFLAGS) -o $(NAME) $(OBJS) $(MLX_FLAGS)

clean:
	rm -f $(OBJS)

fclean: clean
	rm -f $(NAME)

re: fclean all

.PHONY: all clean fclean re

/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   colors.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:28:56 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:28:57 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

int	color_from_iter(int iter, int max_iter)
{
	int	r;
	int	g;
	int	b;
	int	t;

	if (iter >= max_iter)
		return (0x000000);
	t = iter * 255 / max_iter;
	r = (t * 9) % 256;
	g = (t * 2) % 256;
	b = (t * 5) % 256;
	return ((r << 16) | (g << 8) | b);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   events.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:28:51 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 17:55:54 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

#define KEY_ESC 53
#define KEY_PLUS 61
#define KEY_MINUS 45
#define KEY_LEFT 65361
#define KEY_RIGHT 65363
#define KEY_UP 65362
#define KEY_DOWN 65364

int	key_hook(int keycode, void *param)
{
	t_fractol	*f;

	f = (t_fractol *)param;
	if (keycode == KEY_ESC)
	{
		if (f->win)
			mlx_destroy_window(f->mlx, f->win);
		if (f->img.img)
			mlx_destroy_image(f->mlx, f->img.img);
		if (f->mlx)
		{
			mlx_destroy_display(f->mlx);
			free(f->mlx);
		}
		exit(0);
	}
	else if (keycode == KEY_LEFT)
		f->offset_x -= 0.05 / f->zoom;
	else if (keycode == KEY_RIGHT)
		f->offset_x += 0.05 / f->zoom;
	else if (keycode == KEY_UP)
		f->offset_y -= 0.05 / f->zoom;
	else if (keycode == KEY_DOWN)
		f->offset_y += 0.05 / f->zoom;
	else if (keycode == KEY_PLUS)
		f->zoom *= 1.1;
	else if (keycode == KEY_MINUS)
		f->zoom /= 1.1;
	render(f);
	return (0);
}

int	mouse_hook(int button, int x, int y, void *param)
{
	t_fractol	*f;

	f = (t_fractol *)param;
	(void)x;
	(void)y;
	if (button == 4)
		f->zoom *= 1.1;
	else if (button == 5)
		f->zoom /= 1.1;
	render(f);
	return (0);
}

int	close_hook(void *param)
{
	t_fractol	*f;

	f = (t_fractol *)param;
	if (f->win)
		mlx_destroy_window(f->mlx, f->win);
	if (f->img.img)
		mlx_destroy_image(f->mlx, f->img.img);
	if (f->mlx)
	{
		mlx_destroy_display(f->mlx);
		free(f->mlx);
	}
	(void)f;
	exit(0);
	return (0);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   init.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:28:38 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:28:39 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

static int	create_image(t_fractol *f)
{
	f->img.img = mlx_new_image(f->mlx, WIN_W, WIN_H);
	if (!f->img.img)
		return (0);
	f->img.addr = mlx_get_data_addr(f->img.img, &f->img.bpp, &f->img.line_len,
			&f->img.endian);
	return (1);
}

int	init_fractol(t_fractol *f)
{
	f->mlx = mlx_init();
	if (!f->mlx)
		return (0);
	f->win = mlx_new_window(f->mlx, WIN_W, WIN_H, "fractol");
	if (!f->win)
		return (0);
	if (!create_image(f))
		return (0);
	f->zoom = 1.0;
	f->offset_x = 0.0;
	f->offset_y = 0.0;
	f->max_iter = 100;
	mlx_hook(f->win, 2, 1L << 0, key_hook, f);
	mlx_mouse_hook(f->win, mouse_hook, f);
	mlx_hook(f->win, 17, 0L, close_hook, f);
	return (1);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   julia.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:29:50 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:29:51 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

int	julia_iter(double zr, double zi, double cr, double ci, int max_iter)
{
	double	tmp;
	int		i;

	i = 0;
	while (zr * zr + zi * zi <= 4.0 && i < max_iter)
	{
		tmp = zr * zr - zi * zi + cr;
		zi = 2.0 * zr * zi + ci;
		zr = tmp;
		i++;
	}
	return (i);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:29:55 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:29:56 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

static void	usage(void)
{
	write(1, "Usage:\n", 6);
	write(1, "  ./fractol mandelbrot\n", 23);
	write(1, "  ./fractol julia <real> <imag>\n", 31);
}

static int	ft_atoi(const char *str)
{
	int	s;
	int	i;
	int	r;

	s = 1;
	i = 0;
	r = 0;
	while ((str[i] == 32) || (str[i] >= 9 && str[i] <= 13))
		i++;
	if (str[i] == '-' || str[i] == '+')
	{
		if (str[i] == '-')
		{
			s = s * -1;
		}
		i++;
	}
	while (str[i] >= '0' && str[i] <= '9')
	{
		r = (r * 10) + (str[i] - '0');
		i++;
	}
	return (s * r);
}

int	ft_strncmp(const char *s1, const char *s2, size_t n)
{
	size_t	i;

	i = 0;
	while ((unsigned char)s1[i] != '\0'
		&& (unsigned char)s2[i] == (unsigned char)s1[i] && i < n)
	{
		i++;
	}
	if (i == n)
		return (0);
	return ((unsigned char)s1[i] - (unsigned char)s2[i]);
}

int	parse_args(int argc, char **argv, t_fractol *f)
{
	if (argc < 2)
	{
		usage();
		return (0);
	}
	if (ft_strncmp(argv[1], "mandelbrot", 11) == 0 || ft_strncmp(argv[1],
			"Mandelbrot", 11) == 0)
	{
		f->fractal = MANDELBROT;
	}
	else if (ft_strncmp(argv[1], "julia", 6) == 0 || ft_strncmp(argv[1],
			"Julia", 6) == 0)
	{
		f->fractal = JULIA;
		if (argc >= 4)
		{
			f->jr = ft_atoi(argv[2]);
			f->ji = ft_atoi(argv[3]);
		}
		else
		{
			f->jr = -0.7;
			f->ji = 0.27015;
		}
	}
	else
	{
		usage();
		return (0);
	}
	return (1);
}

int	main(int argc, char **argv)
{
	t_fractol	f;

	f.zoom = 1.0;
	f.offset_x = 0.0;
	f.offset_y = 0.0;
	f.max_iter = 100;
	if (!parse_args(argc, argv, &f))
		return (0);
	if (!init_fractol(&f))
		return (error_exit("Failed to initialize MLX\n"));
	render(&f);
	mlx_loop(f.mlx);
	return (0);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   mandelbrot.c                                       :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:29:59 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:30:00 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

int	mandelbrot_iter(double cr, double ci, int max_iter)
{
	double	zr;
	double	zi;
	double	tmp;
	int		i;

	zr = 0.0;
	zi = 0.0;
	i = 0;
	while (zr * zr + zi * zi <= 4.0 && i < max_iter)
	{
		tmp = zr * zr - zi * zi + cr;
		zi = 2.0 * zr * zi + ci;
		zr = tmp;
		i++;
	}
	return (i);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   render.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:27:22 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:27:24 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

void	put_pixel(t_img *img, int x, int y, int color)
{
	char	*dst;
	int		offset;

	if (x < 0 || x >= WIN_W || y < 0 || y >= WIN_H)
		return ;
	offset = (y * img->line_len) + (x * (img->bpp / 8));
	dst = img->addr + offset;
	*(unsigned int *)dst = (unsigned int)color;
}

void	render(t_fractol *f)
{
	int		x;
	int		y;
	int		iter;
	double	cr;
	double	ci;

	y = 0;
	while (y < WIN_H)
	{
		x = 0;
		while (x < WIN_W)
		{
			cr = map_x(x, f);
			ci = map_y(y, f);
			if (f->fractal == MANDELBROT)
				iter = mandelbrot_iter(cr, ci, f->max_iter);
			else
				iter = julia_iter(cr, ci, f->jr, f->ji, f->max_iter);
			put_pixel(&f->img, x, y, color_from_iter(iter, f->max_iter));
			x++;
		}
		y++;
	}
	mlx_put_image_to_window(f->mlx, f->win, f->img.img, 0, 0);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   utils.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:27:49 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:27:50 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

static size_t	ft_strlen(const char *s)
{
	size_t	i;

	i = 0;
	while (s[i] != '\0')
	{
		i++;
	}
	return (i);
}

double	map_x(int x, t_fractol *f)
{
	double	range;

	range = 3.5 / f->zoom;
	return ((x - WIN_W / 2.0) * (range / WIN_W) + f->offset_x);
}

double	map_y(int y, t_fractol *f)
{
	double	range;

	range = 2.0 / f->zoom;
	return ((y - WIN_H / 2.0) * (range / WIN_H) + f->offset_y);
}

int	error_exit(const char *msg)
{
	if (msg)
	{
		write(2, msg, ft_strlen(msg));
	}
	return (0);
}

size_t	strlen(const char *s)
{
	size_t	i;

	i = 0;
	while (s[i])
		i++;
	return (i);
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   fractol.h                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: malsabah <malsabah@student.42amman.com>    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2026/01/07 11:42:43 by malsabah          #+#    #+#             */
/*   Updated: 2026/01/07 11:42:44 by malsabah         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef FRACTOL_H
# define FRACTOL_H

# include "mlx.h"
# include <math.h>
# include <stdlib.h>
# include <stdlib.h>
# include <unistd.h>
# include <stdio.h>
# define WIN_W 800
# define WIN_H 600

typedef enum e_fract
{
	MANDELBROT,
	JULIA
}	t_fract;

typedef struct s_img
{
	void	*img;
	char	*addr;
	int		bpp;
	int		line_len;
	int		endian;
}	t_img;

typedef struct s_fractol
{
	void	*mlx;
	void	*win;
	t_img	img;
	double	zoom;
	double	offset_x;
	double	offset_y;
	int		max_iter;
	double	jr;
	double	ji;
	t_fract	fractal;
}	t_fractol;

int		parse_args(int argc, char **argv, t_fractol *f);
int		init_fractol(t_fractol *f);
int		key_hook(int keycode, void *param);
int		mouse_hook(int button, int x, int y, void *param);
int		close_hook(void *param);
void	render(t_fractol *f);
void	put_pixel(t_img *img, int x, int y, int color);
int		mandelbrot_iter(double cr, double ci, int max_iter);
int		julia_iter(double zr, double zi, double cr, double ci, int max_iter);
double	ft_atof(const char *s);
double	map_x(int x, t_fractol *f);
double	map_y(int y, t_fractol *f);
int		error_exit(const char *msg);
int		color_from_iter(int iter, int max_iter);

#endif
